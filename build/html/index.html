

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Pydefect 安装教程 &mdash; pydefect v0.1 文档</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home"> pydefect
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="在文档中搜索" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Pydefect 安装教程</a><ul>
<li><a class="reference internal" href="#id1">安装简介</a></li>
<li><a class="reference internal" href="#id2">执行软件包</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id3">Pydefect 使用向导</a><ul>
<li><a class="reference internal" href="#id4">1. 原胞松弛</a></li>
<li><a class="reference internal" href="#dos">2. 能带，DOS，和介电张量的计算</a></li>
<li><a class="reference internal" href="#id7">3. 收集与点缺陷相关的原胞信息</a></li>
<li><a class="reference internal" href="#id9">4. 计算竞争相</a></li>
<li><a class="reference internal" href="#id11">5. 构建超胞和缺陷初始设置文件</a></li>
<li><a class="reference internal" href="#id13">6. 决定间隙位点</a></li>
<li><a class="reference internal" href="#id15">7. 缺陷计算目录的创建</a></li>
<li><a class="reference internal" href="#defect-entry-json">8. 生成defect_entry.json文件</a></li>
<li><a class="reference internal" href="#id17">9. 解析超胞计算结果</a></li>
<li><a class="reference internal" href="#id19">10. 有限尺寸超胞缺陷形成能量的修正</a></li>
<li><a class="reference internal" href="#id21">11. 检查超胞计算中的缺陷特征值和能带边缘状态</a></li>
<li><a class="reference internal" href="#id23">12. 绘制缺陷形成能</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id25">第一性原理计算点缺陷相关提示</a><ul>
<li><a class="reference internal" href="#id26">1. 如何处理点缺陷的对称性</a></li>
<li><a class="reference internal" href="#id28">2. 混合函数计算的技巧</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id30">计算垂直跃迁能级向导</a></li>
<li><a class="reference internal" href="#note">Note</a></li>
</ul>
</div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">pydefect</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
        
      <li>Pydefect 安装教程</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/index.rst.txt" rel="nofollow"> 查看页面源码</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pydefect">
<h1>Pydefect 安装教程<a class="headerlink" href="#pydefect" title="永久链接至标题">¶</a></h1>
<p>Pydefect 是一个强大的开源 Python 库，用于基于使用 VASP
代码进行第一性原理计算的非金属固体中的点缺陷计算。</p>
<p>注意：pydefect 中使用的单位为能量：eV 和长度：angstrom，其遵循vasp原理。</p>
<div class="section" id="id1">
<h2>安装简介<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<ol class="arabic">
<li><p>需求</p>
<p>Python 3.7 或更高</p>
<p>vise</p>
<p>pymatgen</p>
<p>see requirements.txt for others</p>
</li>
<li><p>最新的稳定版本在 PyPI 存储库中发布，因此可以使用
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pydefect</span></code> 下载它.</p></li>
<li><p>克隆仓库后，可以使用 python 包管理器 pip 安装 <code class="docutils literal notranslate"><span class="pre">pydefect</span></code>。
为此，请在包含 setup.py 的目录中运行此命令：</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">./</span></code></p>
<p>如果未安装特定版本的软件包，有时会出现错误。
在这种情况下，请尝试使用以下命令安装经过测试可与 <code class="docutils literal notranslate"><span class="pre">pydefect</span></code>
一起使用的确切版本：</p>
<p><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-r</span> <span class="pre">requirements.txt</span> <span class="pre">./</span></code></p>
<p>这将安装 requirements.txt 文件中列出的软件包版本。
为了防止干扰其他程序，建议使用像<a class="reference external" href="https://docs.conda.io/projects/conda/en/latest/index.html">conda</a>
这样的包管理系统。
这允许您在特定环境中安装依赖项，以便可以更轻松地管理和记录它们。
然后可以在 conda 环境中执行上面的命令（在该环境中安装 pip 之后）。</p>
</div>
<div class="section" id="id2">
<h2>执行软件包<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<ol class="arabic simple">
<li><p>使用命令行方法</p></li>
</ol>
<ul class="simple">
<li><p>执行 <strong>pydefect -h</strong> 来获取各选项的细节</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>作为模块使用</p></li>
</ol>
<ul class="simple">
<li><p>pydefect 可以作为 python 模块导入</p></li>
</ul>
<p>更多信息参照（EN）: <a class="reference external" href="https://kumagai-group.github.io/pydefect/">https://kumagai-group.github.io/pydefect/</a></p>
</div>
</div>
<div class="section" id="id3">
<h1>Pydefect 使用向导<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h1>
<p>这个教程展示了如何使用<code class="docutils literal notranslate"><span class="pre">pydefect</span></code>这个code</p>
<p><strong>Note1：Pydefect现在仅支持Vienna ab-initio
模拟包（VASP），因此我们需要使用VASP中的输入输出文件（例如POSCAR、POTCAR、OUTCAR）和其使用的计算技术（例如周期性边界条件）</strong></p>
<p><strong>Note2：Pydefect中使用的单位是eV表示能量，Angstrom表示长度，遵循VASP的惯例</strong></p>
<p><strong>Note3：仅支持非磁性主体材料</strong></p>
<p>非金属固体本征点缺陷计算的工作流程如下图所示。其中有一些任务可以用来并行计算，而另一些还需要等待其他任务，这个过程非常复杂且耗时，研究人员很容易犯一些错误。Pydefect的主要目的是为了给研究点缺陷计算的研究人员提供一种自动化的过程，以节省时间并减少错误。</p>
<div class="figure align-default">
<img alt="" src="https://i.loli.net/2021/06/15/UTISVN1BODGbtLK.png" />
</div>
<p>在这里我们假设有下面的目录树，&lt;project_name&gt;通常是目标材料的晶体结构。例如，金红石-TiO2</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;project_name&gt;
 │
 ├ pydefect.yaml
 ├ vise.yaml
 │
 ├ unitcell/ ── structure_opt/
 │            ├ band/
 │            └ dos/
 │
 ├ competing_phases/ ── &lt;competing_phase 1&gt;
 │                    ├── &lt;competing_phase 2&gt;
 │                    ....
 │
 └ defects/ ── perfect/
              ├─ Va_X_0/
              ├─ Va_X_1/
              ├─ Va_X_2/
             ...
</pre></div>
</div>
<p>我们建议用户遵循相同的目录结构。整个计算的过程细节展示可以通过使用PBEsol泛函计算MgSe的示例来展示。</p>
<div class="section" id="id4">
<span id="id5"></span><h2>1. 原胞松弛<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<p>点缺陷的计算通常在给定的函数和PAW电位下理论松弛结构中进行，因为它没有引起对超胞尺寸没有依赖性的人工应变和应力。因此，通常从优化晶格常数和晶胞中原子位置的分数坐标开始。</p>
<p>我们首先准备原始的块体原胞的<code class="docutils literal notranslate"><span class="pre">POSCAR</span></code>，并且创建一个<code class="docutils literal notranslate"><span class="pre">unitcell/</span></code>目录和<code class="docutils literal notranslate"><span class="pre">unitcell/structure_opt/</span></code>子目录（<code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">-p</span> <span class="pre">unitcell/structure_opt/</span></code>），之后移动到子目录。（<strong>注：本教程中以``/``结尾的名称表示目录</strong>）当<code class="docutils literal notranslate"><span class="pre">Pydefect</span></code>需要构建vasp输入文件，即<code class="docutils literal notranslate"><span class="pre">INCAR</span></code>，<code class="docutils literal notranslate"><span class="pre">POTCAR</span></code>，<code class="docutils literal notranslate"><span class="pre">KPOINTS</span></code>文件时，我们使用vise（=
<code class="docutils literal notranslate"><span class="pre">vasp</span> <span class="pre">intergrated</span> <span class="pre">supporting</span> <span class="pre">environment</span></code>）代码，生成各种任务和交换相关（XC）函数的输入文件。<code class="docutils literal notranslate"><span class="pre">Vise</span></code>依赖于Pymatgen，因此，如
<a class="reference external" href="http://pymatgen.org/">pymatgen</a>所示，我们需要在主目录的<code class="docutils literal notranslate"><span class="pre">.pmgrc.yaml</span></code>文件中设置<code class="docutils literal notranslate"><span class="pre">PMG_DEFAULT_FUNCTIONAL</span></code>和<code class="docutils literal notranslate"><span class="pre">PMG_VASP_PSP_DIR</span></code>，例如：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PMG_DEFAULT_FUNCTIONAL</span><span class="p">:</span> <span class="n">PBE_54</span>

<span class="n">PMG_MAPI_KEY</span><span class="p">:</span> <span class="n">xxxxxxxxxxxxxxxx</span>

<span class="n">PMG_VASP_PSP_DIR</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">kumagai</span><span class="o">/</span><span class="n">potcars</span><span class="o">/</span>
</pre></div>
</div>
<p>在<code class="docutils literal notranslate"><span class="pre">Pydefect</span></code>中，查询<code class="docutils literal notranslate"><span class="pre">POSCAR</span></code>文件和材料的总能量需要实用<code class="docutils literal notranslate"><span class="pre">PMG_MAPI_KEY</span></code>。</p>
<p>使用PBEsol函数优化原胞的输入文件由以下命令生成：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vise</span> <span class="n">vasp_set</span> <span class="o">-</span><span class="n">x</span> <span class="n">pbesol</span>
</pre></div>
</div>
<p>其中<code class="docutils literal notranslate"><span class="pre">vasp_set</span></code>或其缩写<code class="docutils literal notranslate"><span class="pre">vs</span></code>，是<code class="docutils literal notranslate"><span class="pre">vise</span></code>主函数的子命令选项。同样，所有的子命令在<code class="docutils literal notranslate"><span class="pre">pydefect</span></code>和vise中都有自己的缩写。在这里，PBE函数是<code class="docutils literal notranslate"><span class="pre">vise</span></code>中的默认值，因此我们使用<code class="docutils literal notranslate"><span class="pre">-x</span></code>
参数将XC函数切换到PBEsol。每个子命令也有许多参数，可以通过 <code class="docutils literal notranslate"><span class="pre">-h</span></code>
参数来调取帮助获取细节。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">vs</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p><strong>Note：</strong>结构优化通常必须以比1.3倍还大的cutoff energy
进行迭代，直到力和应力在第一个离子步骤收敛。有关详细信息请参阅 <a class="reference external" href="https://www.vasp.at/wiki/index.php/Energy_vs_volume_Volume_relaxations_and_Pulay_stress">vasp
manual</a>
。<code class="docutils literal notranslate"><span class="pre">Pydefect</span></code>不支持vasp计算这种迭代，但可以编写简单的runsell脚本来实现。</p>
<p>在<code class="docutils literal notranslate"><span class="pre">Pydefect</span></code>中，用户可以通过<code class="docutils literal notranslate"><span class="pre">vise</span></code>中的vise,yaml文件控制各种默认参数。有关详细信息，请参阅<a class="reference external" href="https://kumagai-group.github.io/vise/">document
of
vise</a>，可控变量参见<code class="docutils literal notranslate"><span class="pre">pydefect</span></code>中的<code class="docutils literal notranslate"><span class="pre">default.py</span></code>。</p>
</div>
<div class="section" id="dos">
<span id="id6"></span><h2>2. 能带，DOS，和介电张量的计算<a class="headerlink" href="#dos" title="永久链接至标题">¶</a></h2>
<p>计算能带结构（BS）、态密度（DOS）、
和介电常数。在缺陷的计算中，BS用于确定价带顶（VBM）和导带底（CBM），而静态介电常数，或ion-clamped和离子介电张量的总和，用于校正缺陷形成能。</p>
<p>首先，我们在unitcell/中创建band/，dos/和dielectric/文件夹，并且从unitcell/structure_opt/复制POSCAR文件，在每个目录下输入以下命令</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vise</span> <span class="n">vs</span> <span class="o">-</span><span class="n">x</span> <span class="n">pbesol</span> <span class="o">-</span><span class="n">t</span> <span class="o">&lt;</span><span class="n">band</span><span class="p">,</span> <span class="n">dos</span> <span class="ow">or</span> <span class="n">dielectric_dfpt</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Vise</span></code> 还提供 BS 和 DOS的绘图功能. 在 <a class="reference external" href="https://kumagai-group.github.io/vise/">document of
vise</a> 中查看细节。</p>
</div>
<div class="section" id="id7">
<span id="id8"></span><h2>3. 收集与点缺陷相关的原胞信息<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h2>
<p>接下来，我们使用unitcell（=
u）子命令来收集大量信息，即带边缘和ion-clamped和离子介电张量</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">u</span> <span class="o">--</span><span class="n">vasprun_band</span> <span class="n">band</span><span class="o">/</span><span class="n">vasprun</span><span class="o">.</span><span class="n">xml</span> <span class="o">--</span><span class="n">outcar_band</span> <span class="n">band</span><span class="o">/</span><span class="n">OUTCAR</span> <span class="o">--</span><span class="n">outcar_dielectric_clamped</span> <span class="n">dielectric</span><span class="o">/</span><span class="n">OUTCAR</span> <span class="o">--</span><span class="n">outcar_dielectric_ionic</span> <span class="n">dielectric</span><span class="o">/</span><span class="n">OUTCAR</span>
</pre></div>
</div>
<p>在这里，可以使用不同的OUTCAR文件设置ion-clamped和离子介电常数。然后，生成uitcell.json用于分析缺陷计算。一般json文件可读性价差，所以我们实现了print（=p）子命令，从json文件生成刻度的命令行输出，如下。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">p</span> <span class="o">-</span><span class="n">f</span> <span class="n">unitcell</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>原胞信息展示如下</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Unitcell</span><span class="p">(</span><span class="n">vbm</span><span class="o">=</span><span class="mf">0.5461</span><span class="p">,</span> <span class="n">cbm</span><span class="o">=</span><span class="mf">3.0807</span><span class="p">,</span> <span class="n">ele_dielectric_const</span><span class="o">=</span><span class="p">[[</span><span class="mf">4.645306</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">4.645306</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">4.645306</span><span class="p">]],</span> <span class="n">ion_dielectric_const</span><span class="o">=</span><span class="p">[[</span><span class="mf">2.584237</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.584192</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.584151</span><span class="p">]])</span>
</pre></div>
</div>
<p>用户有时候想要手动设置原胞参数，在这种情况下，使用python
script或是ipython设置参数，转储yaml文件，如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">pydefect.analyzer.unitcell</span> <span class="kn">import</span> <span class="n">Unitcell</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">u</span> <span class="o">=</span> <span class="n">Unitcell</span><span class="p">(</span><span class="n">vbm</span><span class="o">=</span><span class="mf">3.0675</span><span class="p">,</span><span class="n">cbm</span><span class="o">=</span><span class="mf">7.7262</span><span class="p">,</span> <span class="n">ele_dielectric_const</span><span class="o">=</span><span class="p">[[</span><span class="mf">3.157296</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mf">3.157296</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">3.157296</span><span class="p">]],</span> <span class="n">ion_dielectric_const</span><span class="o">=</span><span class="p">[[</span><span class="mf">6.811496</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
   <span class="o">...</span><span class="p">:</span> <span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">6.811496</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">6.811496</span><span class="p">]])</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">u</span><span class="o">.</span><span class="n">to_json_file</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<span id="id10"></span><h2>4. 计算竞争相<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h2>
<p>当引入缺陷时，原子与热力学框架内的假设的原子库交换。
在大多数情况下，为了计算与缺陷形成能近似的缺陷形成自由能，我们需要确定与产生缺陷相关的原子化学势。
通常，我们考虑竞争相与主体材料共存条件下的化学势，由化学势图确定。</p>
<p>为此，我们在<code class="docutils literal notranslate"><span class="pre">competition_phases/</span></code> 中创建目录。 我们可以从 <a class="reference external" href="https://materialsproject.org/">the
Materials Project (MP)</a>
中检索稳定或略微不稳定的竞争相的 POSCAR。 为此，需要 MP 的 <a class="reference external" href="https://materialsproject.org/open">the API
keys</a> 密钥。 在这里，我们获得了与
MgSe 竞争的材料，其凸包上方的能量小于 0.5 meV/atom，使用</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">mp</span> <span class="o">-</span><span class="n">e</span> <span class="n">Mg</span> <span class="n">Se</span> <span class="o">--</span><span class="n">e_above_hull</span> <span class="mf">0.0005</span>
</pre></div>
</div>
<p>此命令创建以下目录：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Mg149Se_mp</span><span class="o">-</span><span class="mi">1185632</span><span class="o">/</span> <span class="n">MgSe_mp</span><span class="o">-</span><span class="mi">13031</span><span class="o">/</span> <span class="n">Mg_mp</span><span class="o">-</span><span class="mi">1094122</span><span class="o">/</span> <span class="n">Se_mp</span><span class="o">-</span><span class="mi">570481</span><span class="o">/</span>
</pre></div>
</div>
<p>每个目录下都有POSCAR和prior_info.yaml。 prior_info.yaml 包含了 Materials
Project 数据库中的一些信息，这对于确定第一性原理计算条件很有用。</p>
<p>比如， <code class="docutils literal notranslate"><span class="pre">Mg_mp-1094122/prior_info.yaml</span></code> ：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">band_gap</span><span class="p">:</span> <span class="mf">0.0</span>
<span class="n">data_source</span><span class="p">:</span> <span class="n">mp</span><span class="o">-</span><span class="mi">1094122</span>
<span class="n">total_magnetization</span><span class="p">:</span> <span class="mf">0.00010333333333333333</span>
</pre></div>
</div>
<p>这意味着 Mg 是一种非磁性金属系统。 <code class="docutils literal notranslate"><span class="pre">Vise</span></code> 解析<code class="docutils literal notranslate"><span class="pre">prior_info.yaml</span></code>
并通过INCAR 中的<code class="docutils literal notranslate"><span class="pre">ISPIN</span></code> 标签确定<code class="docutils literal notranslate"><span class="pre">KPOINTS</span></code> 中的k
点密度和自旋极化。</p>
<p>请注意，O<sub>2</sub>、H<sub>2</sub>、N<sub>2</sub>、NH<sub>3</sub>和 NO<sub>2</sub>分子不是从 MP 中提取的，而是由
<code class="docutils literal notranslate"><span class="pre">pydefect</span></code> 产生的，因为这些分子在 MP
中已计算为固体，这可能不足以用于缺陷计算的竞争相。</p>
<p>之后为竞争的固体和分子生成 <code class="docutils literal notranslate"><span class="pre">INCAR</span></code>、<code class="docutils literal notranslate"><span class="pre">POTCAR</span></code>、<code class="docutils literal notranslate"><span class="pre">KPOINTS</span></code>
文件。 请注意，我们使用常规的截止能量 ENCUT 来比较总能量（total
energy），该能量增加到<code class="docutils literal notranslate"><span class="pre">POTCARs</span></code> 组分之间最大 的<code class="docutils literal notranslate"><span class="pre">ENMAX</span></code> 的 1.3
倍。 MgSe，Mg 和 O 的 <code class="docutils literal notranslate"><span class="pre">ENMAX</span></code> 为 200.0 和 211.555 eV，因此我们需要设置
<code class="docutils literal notranslate"><span class="pre">ENCUT</span></code> = 275.022，使用vise：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>for i in *_*/;do cd $i; vise vs -uis ENCUT 275.022 -x pbesol ; cd ../;done
</pre></div>
</div>
<p>本例中的 MgSe 已经计算完毕，因此我们不必重复相同的计算； 在删除
<code class="docutils literal notranslate"><span class="pre">MgSe_mp-13031/</span></code> 后通过 <code class="docutils literal notranslate"><span class="pre">ln</span> <span class="pre">-s</span> <span class="pre">../unitcell/structure_opt</span> <span class="pre">MgSe</span></code>
创建符号链接。 但是，如果我们用不同的 <code class="docutils literal notranslate"><span class="pre">ENMAX</span></code>
计算它来使得其与更大的掺杂原子 <code class="docutils literal notranslate"><span class="pre">ENMAX</span></code> 保持一致，这里就需要重新计算。</p>
<p><strong>Note：</strong>如果竞争相是气体，我们需要将 <code class="docutils literal notranslate"><span class="pre">ISIF</span></code> 更改为
2，以免晶格常数松弛（参见[<a class="reference external" href="https://cms.mpi.univie.ac.at/wiki/index.php/ISIF">vasp
manual]</a>），并将
<code class="docutils literal notranslate"><span class="pre">KPOINTS</span></code> 更改为 Gamma 点采样。
这里是通过<code class="docutils literal notranslate"><span class="pre">prior_info.yaml</span></code>使用<code class="docutils literal notranslate"><span class="pre">vise</span></code>自动调整的。</p>
<p>完成<code class="docutils literal notranslate"><span class="pre">vasp</span></code>计算后，我们可以使用<code class="docutils literal notranslate"><span class="pre">make_cpd(=</span> <span class="pre">mcpd)</span></code>子命令生成化学势图的json文件：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">mcpd</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span>
</pre></div>
</div>
<p>将<code class="docutils literal notranslate"><span class="pre">vasprun.xml</span></code>和<code class="docutils literal notranslate"><span class="pre">OUTCAR</span></code>文件重命名，例如：<code class="docutils literal notranslate"><span class="pre">vasprun-finish.xml</span></code>和<code class="docutils literal notranslate"><span class="pre">OUTCAR-finish</span></code>，此时需要在<code class="docutils literal notranslate"><span class="pre">pydefect.yaml</span></code>文件中写入以下内容：</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># VASP file names</span>
<span class="nt">outcar</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">OUTCAR-finish</span>
<span class="nt">vasprun</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">vasprun-finish.xml</span>
</pre></div>
</div>
<p>要绘制化学势图，请使用 <code class="docutils literal notranslate"><span class="pre">plot_cpd</span></code> (= <code class="docutils literal notranslate"><span class="pre">pcpd</span></code>) 子命令：</p>
<div class="figure align-default">
<img alt="" src="https://i.loli.net/2021/06/15/It8ZAjBPudvsETO.png" />
</div>
<div class="figure align-default">
<img alt="" src="https://i.loli.net/2021/06/15/6KeOhAUNd5n4cHz.png" />
</div>
<p>此时，顶点处的相对化学势显示如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+----+---------+--------+---------+</span>
<span class="o">|</span>    <span class="o">|</span>   <span class="n">mu_Ba</span> <span class="o">|</span>   <span class="n">mu_O</span> <span class="o">|</span>   <span class="n">mu_Sn</span> <span class="o">|</span>
<span class="o">|----+---------+--------+---------|</span>
<span class="o">|</span> <span class="n">A</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">5.927</span> <span class="o">|</span>  <span class="mi">0</span>     <span class="o">|</span>  <span class="o">-</span><span class="mf">4.966</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">B</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">5.581</span> <span class="o">|</span>  <span class="mi">0</span>     <span class="o">|</span>  <span class="o">-</span><span class="mf">5.312</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">C</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">3.124</span> <span class="o">|</span> <span class="o">-</span><span class="mf">2.59</span>  <span class="o">|</span>   <span class="mi">0</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">D</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">5.352</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.114</span> <span class="o">|</span>  <span class="o">-</span><span class="mf">5.198</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">E</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">2.753</span> <span class="o">|</span> <span class="o">-</span><span class="mf">2.713</span> <span class="o">|</span>   <span class="mi">0</span>     <span class="o">|</span>
<span class="o">|</span> <span class="n">F</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">3.558</span> <span class="o">|</span> <span class="o">-</span><span class="mf">2.37</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">0.226</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">G</span>  <span class="o">|</span>  <span class="o">-</span><span class="mf">3.503</span> <span class="o">|</span> <span class="o">-</span><span class="mf">2.4</span>   <span class="o">|</span>  <span class="o">-</span><span class="mf">0.189</span> <span class="o">|</span>
<span class="o">+----+---------+--------+---------+</span>
</pre></div>
</div>
<p>如果需要修改化学势图的能量，可以直接修改<code class="docutils literal notranslate"><span class="pre">vertices_MgO.yaml</span></code>文件。</p>
<p>竞争相的计算通常很费力，有时我们想尽快粗略地检查缺陷形成能。
<code class="docutils literal notranslate"><span class="pre">Pydefect</span></code> 支持从 Materials Project 数据库创建化学势图。
然而，要做到这一点，需要准备调整元素能量标准所需的原子能量。</p>
<p>使用<code class="docutils literal notranslate"><span class="pre">vise</span></code>，可以轻松准备原子计算目录。 在这里，我们展示了 BaSnO3
的示例：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vise</span> <span class="nb">map</span> <span class="o">-</span><span class="n">e</span> <span class="n">Ba</span> <span class="n">Sn</span> <span class="n">O</span>
</pre></div>
</div>
<p>然后创建vasp输入文件：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>for i in */;do cd $i; vise vs ; cd ../;done
</pre></div>
</div>
<p>运行 vasp。 使用 python 脚本将原子能收集到 yaml 文件中。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#  Copyright (c) 2020. Distributed under the terms of the MIT License.</span>

<span class="kn">from</span> <span class="nn">pymatgen</span> <span class="kn">import</span> <span class="n">Element</span>
<span class="kn">from</span> <span class="nn">pymatgen.io.vasp</span> <span class="kn">import</span> <span class="n">Outcar</span>

<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">Element</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">o</span> <span class="o">=</span> <span class="n">Outcar</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/OUTCAR-finish&quot;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s2">&lt;3</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">o</span><span class="o">.</span><span class="n">final_energy</span><span class="si">:</span><span class="s2">11.8f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>假设输出保存到 <code class="docutils literal notranslate"><span class="pre">atom_energies.yaml</span></code>。 然后使用以下命令生成
<code class="docutils literal notranslate"><span class="pre">cpd.yaml</span></code> 文件。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">mcpd</span> <span class="o">-</span><span class="n">e</span> <span class="n">Ba</span> <span class="n">Sn</span> <span class="n">O</span> <span class="o">-</span><span class="n">t</span> <span class="n">BaSnO3</span> <span class="o">-</span><span class="n">a</span> <span class="n">atom_energies</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<span id="id12"></span><h2>5. 构建超胞和缺陷初始设置文件<a class="headerlink" href="#id11" title="永久链接至标题">¶</a></h2>
<p>我们已经完成了晶胞和竞争相的计算，最终准备进行点缺陷计算。
让我们创建<code class="docutils literal notranslate"><span class="pre">defect/</span></code>目录并从复制unitcell <code class="docutils literal notranslate"><span class="pre">POSCAR</span></code>文件
<code class="docutils literal notranslate"><span class="pre">unitcell/dos/</span></code>到<code class="docutils literal notranslate"><span class="pre">defect/</span></code></p>
<p>然后，使用 <code class="docutils literal notranslate"><span class="pre">supercell</span></code> (= <code class="docutils literal notranslate"><span class="pre">s</span></code>) 和<code class="docutils literal notranslate"><span class="pre">defect_set</span></code> (= <code class="docutils literal notranslate"><span class="pre">ds</span></code>)
子命令创建超胞和缺陷类型等相关文件。 <code class="docutils literal notranslate"><span class="pre">Pydefect</span></code>
推荐由中等数量的原子组成的近乎各向同性（有时类似于立方体）的超胞。
使用以下命令，可以创建 <code class="docutils literal notranslate"><span class="pre">SPOSCAR</span></code> 文件</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">s</span>
</pre></div>
</div>
<p>如果输入结构与标准化原胞不同，会引发 <code class="docutils literal notranslate"><span class="pre">NotPrimitiveError</span></code>错误。</p>
<p><code class="docutils literal notranslate"><span class="pre">pydefect</span></code>是通过扩展<strong>惯用原胞</strong>（<em>conventional</em>
unitcell）来构建超胞。</p>
<p>可以改变超胞的晶格角，而不是惯用原胞的晶格角。
例如，我们可以制作一个超胞，其中 a、b 和 c 轴在立方晶系中相互正交。
然而，这对于点缺陷计算并不是一个好的情况，因为这种晶格打破了原始的对称性，降低了点缺陷计算的准确性，并且难以分析缺陷位点的对称性。
pydefect 中的一个例外是四方晶系，可将超胞旋转45度来保持原始对称性。</p>
<p>在<code class="docutils literal notranslate"><span class="pre">pydefect</span></code>中，用户可以指定晶胞矩阵：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">s</span> <span class="o">--</span><span class="n">matrix</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mi">1</span>
</pre></div>
</div>
<p>该矩阵适用于惯用原胞。如果想要知道惯用原胞，键入：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">s</span> <span class="o">--</span><span class="n">matrix</span> <span class="mi">1</span>
</pre></div>
</div>
<p>来检视更多细节。</p>
<p><code class="docutils literal notranslate"><span class="pre">supercell_info.json</span></code> 文件包含有关超胞的完整信息，可以使用 <code class="docutils literal notranslate"><span class="pre">-p</span></code>
选项查看这些信息。</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>Space group: F-43m
Transformation matrix: [-2, 2, 2]  [2, -2, 2]  [2, 2, -2]
Cell multiplicity: 32

   Irreducible element: Mg1
        Wyckoff letter: a
         Site symmetry: -43m
         Cutoff radius: 3.373
          Coordination: {&#39;Se&#39;: [2.59, 2.59, 2.59, 2.59]}
      Equivalent atoms: 0..31
Fractional coordinates: 0.0000000  0.0000000  0.0000000
     Electronegativity: 1.31
       Oxidation state: 2

   Irreducible element: Se1
        Wyckoff letter: c
         Site symmetry: -43m
         Cutoff radius: 3.373
          Coordination: {&#39;Mg&#39;: [2.59, 2.59, 2.59, 2.59]}
      Equivalent atoms: 32..63
Fractional coordinates: 0.1250000  0.1250000  0.1250000
     Electronegativity: 2.55
       Oxidation state: -2
</pre></div>
</div>
<p>使用<code class="docutils literal notranslate"><span class="pre">defect_set</span></code>（=
<code class="docutils literal notranslate"><span class="pre">ds</span></code>）子命令，构建<code class="docutils literal notranslate"><span class="pre">defect_in.yaml</span></code>文件。MgSe的<code class="docutils literal notranslate"><span class="pre">defect_in.yaml</span></code>如下</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">Mg_Se1</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">0</span><span class="p p-Indicator">,</span> <span class="nv">1</span><span class="p p-Indicator">,</span> <span class="nv">2</span><span class="p p-Indicator">,</span> <span class="nv">3</span><span class="p p-Indicator">,</span> <span class="nv">4</span><span class="p p-Indicator">]</span>
<span class="nt">Se_Mg1</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">-4</span><span class="p p-Indicator">,</span> <span class="nv">-3</span><span class="p p-Indicator">,</span> <span class="nv">-2</span><span class="p p-Indicator">,</span> <span class="nv">-1</span><span class="p p-Indicator">,</span> <span class="nv">0</span><span class="p p-Indicator">]</span>
<span class="nt">Va_Mg1</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">-2</span><span class="p p-Indicator">,</span> <span class="nv">-1</span><span class="p p-Indicator">,</span> <span class="nv">0</span><span class="p p-Indicator">]</span>
<span class="nt">Va_Se1</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">0</span><span class="p p-Indicator">,</span> <span class="nv">1</span><span class="p p-Indicator">,</span> <span class="nv">2</span><span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>其中显示了缺陷类型及其电荷。 如有必要，我们可以使用编辑器进行修改。
如果我们想掺杂，可以输入如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">ds</span> <span class="o">-</span><span class="n">d</span> <span class="n">Ca</span>
</pre></div>
</div>
<p>有一些与<code class="docutils literal notranslate"><span class="pre">supercell_info.json</span></code> 和<code class="docutils literal notranslate"><span class="pre">defect_in.yaml</span></code>
相关的注意事项：</p>
<ol class="arabic simple">
<li><p>反位点缺陷和取代缺陷由取代和去除原子之间的电负性差异确定。
默认最大差异写在 <code class="docutils literal notranslate"><span class="pre">defaults.py</span></code> 中，但可以通过 <code class="docutils literal notranslate"><span class="pre">pydefect.yaml</span></code>
更改它，如上所述。</p></li>
<li><p>氧化态决定缺陷电荷态。 例如，Sn<sup>2+</sup>的空位（间隙）可以采用 0、-(+)1 或
-(+)2 电荷态，而 Sn<sup>4+</sup>的空位（间隙）则介于 0 和 -(+)4 电荷态之间。
对于反位点和替代缺陷，<code class="docutils literal notranslate"><span class="pre">pydefect</span></code> 考虑空位和间隙的所有可能的组合。
因此，例如，Sn<sup>2+</sup>-on- Sn<sup>2-</sup>具有 0、+1、+2、+3 和 +4 电荷态。 使用
<code class="docutils literal notranslate"><span class="pre">pymatgen</span></code> 中 Composition 类的 <code class="docutils literal notranslate"><span class="pre">oxi_state_guesses</span></code>
方法确定氧化态。 用户也可以手动设置氧化态如下：</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">ds</span> <span class="o">--</span><span class="n">oxi_states</span> <span class="n">Mg</span> <span class="mi">4</span>
</pre></div>
</div>
<p>然而，在某些情况下，电荷状态的范围可能不够。 例如，已知 ZnO 中的 Zn
空位显示 +1 电荷态，因为它们可以在相邻的 O 位点捕获多个极化子。 参见</p>
<p>用户必须自己添加这些异常值。</p>
<ol class="arabic simple">
<li><p>默认情况下，与缺陷相邻的原子的位置被扰动，使得对称性降低到 P1。
然而，这在某些情况下是不需要的，因为它增加了不可约
k-points的数量然后，需要通过 <code class="docutils literal notranslate"><span class="pre">pydefect.yaml</span></code> 将
<code class="docutils literal notranslate"><span class="pre">displace_distance</span></code> 设置为 0。</p></li>
<li><p>如果你想计算特定的缺陷，例如，只有氧空位，你可以用 <code class="docutils literal notranslate"><span class="pre">-k</span></code> 选项和
python 正则表达式来限制计算的缺陷，例如，当输入如下时，</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">ds</span> <span class="o">-</span><span class="n">k</span> <span class="s2">&quot;Va_O[0-9]?_[0-9]+&quot;</span>
</pre></div>
</div>
<p>创建这些目录。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">perfect</span><span class="o">/</span> <span class="n">Va_O1_0</span><span class="o">/</span> <span class="n">Va_O1_1</span><span class="o">/</span> <span class="n">Va_O1_2</span><span class="o">/</span>
</pre></div>
</div>
</div>
<div class="section" id="id13">
<span id="id14"></span><h2>6. 决定间隙位点<a class="headerlink" href="#id13" title="永久链接至标题">¶</a></h2>
<p>除了空位和反位点，人们可能还想考虑间隙。
大多数人通过观察主体晶体结构来确定它们，有一些程序也可以推荐间隙位点。
然而，推测最可能的间隙位点通常不是一件容易的事，因为它们取决于被取代的元素。</p>
<p>最大的空位应该是带有封闭壳层的带正电阳离子（例如
Mg<sup>2+</sup>、Al<sup>3+</sup>）的间隙位点，因为它们往往不会与其他原子形成牢固的键合。
另一方面，质子 (H<sup>+</sup>) 更喜欢位于 O<sup>2-</sup>或 N<sup>3-</sup>附近以形成强的 O-H 或 N-H 键。
相反，氢化物离子 (H<sup>-</sup>) 应该更喜欢位于不同的位置。
因此，我们需要仔细确定间隙位置。</p>
<p><code class="docutils literal notranslate"><span class="pre">pydefect</span></code> 拥有一个实用程序，它使用 pymatgen 中实现的
<code class="docutils literal notranslate"><span class="pre">ChargeDensityAnalyzer</span></code> 类，根据晶胞中的所有电子电荷密度推荐间隙位点。
为此，我们需要基于标准化的原胞生成 <code class="docutils literal notranslate"><span class="pre">AECCAR0</span></code> 和 <code class="docutils literal notranslate"><span class="pre">AECCAR2</span></code>。</p>
<p>也可以在 DOS 计算中添加此任务。 <code class="docutils literal notranslate"><span class="pre">vise</span></code>的命令是：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vise</span> <span class="n">vs</span> <span class="o">-</span><span class="n">uis</span> <span class="n">LAECHG</span> <span class="kc">True</span> <span class="o">-</span><span class="n">t</span> <span class="n">dos</span>
</pre></div>
</div>
<p>这不应该在 BS 计算中完成，因为原胞可能与特定空间群中的标准化原胞不同。</p>
<p>运行vasp计算后，运行<code class="docutils literal notranslate"><span class="pre">pydefect</span></code>中的<code class="docutils literal notranslate"><span class="pre">recommote_interstitials.py</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">pydefect</span><span class="o">/</span><span class="n">cli</span><span class="o">/</span><span class="n">vasp</span><span class="o">/</span><span class="n">util_commands</span><span class="o">/</span><span class="n">recommend_interstitials</span><span class="o">.</span><span class="n">py</span> <span class="n">AECCAR0</span> <span class="n">AECCAR2</span>
</pre></div>
</div>
<p>，其显示电荷密度的局部极小点如下。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>          <span class="n">a</span>         <span class="n">b</span>         <span class="n">c</span>  <span class="n">Charge</span> <span class="n">Density</span>
<span class="mi">0</span>  <span class="mf">0.750000</span>  <span class="mf">0.750000</span>  <span class="mf">0.750000</span>        <span class="mf">0.527096</span>
<span class="mi">1</span>  <span class="mf">0.500000</span>  <span class="mf">0.500000</span>  <span class="mf">0.500000</span>        <span class="mf">0.669109</span>
<span class="mi">2</span>  <span class="mf">0.611111</span>  <span class="mf">0.611111</span>  <span class="mf">0.166667</span>        <span class="mf">1.020380</span>
<span class="mi">3</span>  <span class="mf">0.166667</span>  <span class="mf">0.611111</span>  <span class="mf">0.611111</span>        <span class="mf">1.020382</span>
<span class="mi">4</span>  <span class="mf">0.611111</span>  <span class="mf">0.166667</span>  <span class="mf">0.611111</span>        <span class="mf">1.020382</span>
<span class="n">Host</span> <span class="n">symmetry</span> <span class="n">R3m</span>
<span class="o">++</span> <span class="n">Inequivalent</span> <span class="n">indices</span> <span class="ow">and</span> <span class="n">site</span> <span class="n">symmetries</span> <span class="o">++</span>
  <span class="mi">0</span>   <span class="mf">0.7500</span>   <span class="mf">0.7500</span>   <span class="mf">0.7500</span> <span class="mi">3</span><span class="n">m</span>
  <span class="mi">1</span>   <span class="mf">0.5000</span>   <span class="mf">0.5000</span>   <span class="mf">0.5000</span> <span class="mi">3</span><span class="n">m</span>
  <span class="mi">2</span>   <span class="mf">0.6111</span>   <span class="mf">0.6111</span>   <span class="mf">0.1667</span> <span class="o">.</span><span class="n">m</span>
</pre></div>
</div>
<p>再次注意，局部最小值可能不是某些特定间隙的最佳初始点，用户必须注意到此过程的限制。</p>
<p>要在例如 0.75 0.75 0.75
处添加间隙位点，其中分数坐标基于标准化原胞，我们使用间隙 (= <code class="docutils literal notranslate"><span class="pre">i</span></code>)
子命令，如</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">ai</span> <span class="o">-</span><span class="n">s</span> <span class="n">supercell_info</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">p</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">structure_opt</span><span class="o">/</span><span class="n">POSCAR</span> <span class="o">-</span><span class="n">c</span> <span class="mf">0.75</span> <span class="mf">0.75</span> <span class="mf">0.75</span>
</pre></div>
</div>
<p>然后更新 <code class="docutils literal notranslate"><span class="pre">supercell_info.json</span></code>，其中包括间隙位点的信息。</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>...
-- interstitials
#1
Fractional coordinates: 0.3750000  0.3750000  0.3750000
        Wyckoff letter: c
         Site symmetry: -43m
          Coordination: {&#39;Mg&#39;: [2.59, 2.59, 2.59, 2.59], &#39;Se&#39;: [3.0, 3.0, 3.0, 3.0, 3.0, 3.0]}
</pre></div>
</div>
<p>如果我们想添加另一个位点，例如 0.5 0.5 0.5 ，
在<code class="docutils literal notranslate"><span class="pre">supercell_info.json</span></code>再次输入 。</p>
<p>要弹出间隙位点，使用：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">pi</span> <span class="o">-</span><span class="n">i</span> <span class="mi">1</span> <span class="o">-</span><span class="n">s</span> <span class="n">supercell_info</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>从 <code class="docutils literal notranslate"><span class="pre">supercell_info.json</span></code> 中删除了位于 (0.75, 0.75, 0.75)
的第一个间隙位点。</p>
</div>
<div class="section" id="id15">
<span id="id16"></span><h2>7. 缺陷计算目录的创建<a class="headerlink" href="#id15" title="永久链接至标题">¶</a></h2>
<p>我们接下来使用<code class="docutils literal notranslate"><span class="pre">defect_entries</span></code>（=
<code class="docutils literal notranslate"><span class="pre">de</span></code>）子命令为点缺陷计算创建目录，</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">de</span>
</pre></div>
</div>
<p>使用该命令创建缺陷计算目录，包括<code class="docutils literal notranslate"><span class="pre">perfect/</span></code>。</p>
<p>如果再次键入相同的命令，则会出现以下信息，</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2020</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">24</span> <span class="mi">20</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">27</span>    <span class="n">INFO</span> <span class="n">pydefect</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">main_function</span>
 <span class="o">--&gt;</span> <span class="n">perfect</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="mi">2020</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">24</span> <span class="mi">20</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">27</span>    <span class="n">INFO</span> <span class="n">pydefect</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">main_function</span>
 <span class="o">--&gt;</span> <span class="n">Va_Se1_1</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="mi">2020</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">24</span> <span class="mi">20</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">27</span>    <span class="n">INFO</span> <span class="n">pydefect</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">main_function</span>
 <span class="o">--&gt;</span> <span class="n">Va_Se1_2</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="mi">2020</span><span class="o">/</span><span class="mi">11</span><span class="o">/</span><span class="mi">24</span> <span class="mi">20</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">27</span>    <span class="n">INFO</span> <span class="n">pydefect</span><span class="o">.</span><span class="n">cli</span><span class="o">.</span><span class="n">vasp</span><span class="o">.</span><span class="n">main_function</span>
 <span class="o">--&gt;</span> <span class="n">Va_Se1_0</span> <span class="nb">dir</span> <span class="n">exists</span><span class="p">,</span> <span class="n">so</span> <span class="n">skipped</span><span class="o">...</span>
<span class="o">...</span>
</pre></div>
</div>
<p>没有新创建的目录。 这是一种防失误处理，以免误删除计算出的目录。
如果确实要重新创建目录，则需要先删除或移动原目录。</p>
<p>在每个目录中，可以找到<code class="docutils literal notranslate"><span class="pre">defect_entry.json</span></code>
文件，该文件包含有关运行第一性原理计算之前获得的点缺陷的信息。
要查看<code class="docutils literal notranslate"><span class="pre">defect_entry.json</span></code>，请再次使用<code class="docutils literal notranslate"><span class="pre">-p</span></code> 选项。</p>
<p>当你想添加一些特定的缺陷时，你可以修改<code class="docutils literal notranslate"><span class="pre">defect_in.yaml</span></code>并再次输入<code class="docutils literal notranslate"><span class="pre">de</span></code>选项。</p>
</div>
<div class="section" id="defect-entry-json">
<span id="defectentryjson"></span><h2>8. 生成defect_entry.json文件<a class="headerlink" href="#defect-entry-json" title="永久链接至标题">¶</a></h2>
<p>有时，人们可能想要处理复杂的缺陷。 例如，O<sub>2</sub>分子在 MgO<sub>2</sub>中充当阴离子，其中 O<sub>2</sub>分子空位能够存在。 还有其他例子，比如甲基铵卤化铅
(MAPI)，其中甲基铵离子充当单个正阳离子 (CH<sub>3</sub>NH<sub>3</sub><sup>+</sup>) 和 DX
中心，其中阴离子空位和阳离子间隙共存。</p>
<p>在这些情况下，需要准备输入文件并自己运行 vasp 计算。
但是，<code class="docutils literal notranslate"><span class="pre">pydefect</span></code> 需要<code class="docutils literal notranslate"><span class="pre">defect_entry.json</span></code>
文件用于后处理，用户无法轻松生成该文件。</p>
<p>为此，<code class="docutils literal notranslate"><span class="pre">pydefect</span></code> 提供了 <code class="docutils literal notranslate"><span class="pre">create_defect_entry.py</span></code>，它解析
<code class="docutils literal notranslate"><span class="pre">POSCAR</span></code> 文件和缺陷名称：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python $PATH_TO_FILE/create_defect_entry.py complex_2 complex_2/POSCAR perfect/POSCAR
</pre></div>
</div>
<p>它创建了<code class="docutils literal notranslate"><span class="pre">defect_entry.json</span></code> 文件。 然后将目录名称解析为</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">A_B</span> <span class="o">-&gt;</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="n">B</span>
</pre></div>
</div>
<p>可以使用这个脚本来分析正在进行的缺陷计算。</p>
</div>
<div class="section" id="id17">
<span id="id18"></span><h2>9. 解析超胞计算结果<a class="headerlink" href="#id17" title="永久链接至标题">¶</a></h2>
<p>然后，让我们运行 vasp 计算。</p>
<p>要创建 vasp 输入文件，请键入</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>for i in */;do cd $i; vise vs -t defect ; cd ../;done
</pre></div>
</div>
<p>不要忘记添加 <code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">defect</span></code>，为缺陷创建输入文件。</p>
<p>运行 vasp 时，如果 k point仅在大型超胞的 Gamma 点采样，我们建议用户使用
Gamma-only vasp。</p>
<p>在（部分）完成 Vasp
计算后，我们可以生成包含与缺陷属性相关的第一性原理计算结果的
<code class="docutils literal notranslate"><span class="pre">calc_results.json</span></code>。</p>
<p>通过使用 <code class="docutils literal notranslate"><span class="pre">calc_results</span></code> (= cr) 子命令，我们可以在所有计算的目录中生成
<code class="docutils literal notranslate"><span class="pre">calc_results.json</span></code>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">cr</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span> <span class="n">perfect</span>
</pre></div>
</div>
<p>当想要为某些特定目录（例如 Va_O1_0）生成 <code class="docutils literal notranslate"><span class="pre">calc_results.json</span></code>
时，请键入</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">cr</span> <span class="o">-</span><span class="n">d</span> <span class="n">Va_O1_0</span>
</pre></div>
</div>
</div>
<div class="section" id="id19">
<span id="id20"></span><h2>10. 有限尺寸超胞缺陷形成能量的修正<a class="headerlink" href="#id19" title="永久链接至标题">¶</a></h2>
<p>当在周期性边界条件下采用超胞方法时，由于缺陷、其图像和背景电荷之间的相互作用，带电缺陷的总能量无法正确估计。
因此，我们需要将带电缺陷超胞的总能量修正为稀释极限内的能量。</p>
<p>使用<code class="docutils literal notranslate"><span class="pre">extended_fnv_correction</span></code> (= <code class="docutils literal notranslate"><span class="pre">efnv</span></code>) 子命令进行校正，</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">efnv</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span> <span class="o">-</span><span class="n">pcr</span> <span class="n">perfect</span><span class="o">/</span><span class="n">calc_results</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">u</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">unitcell</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>对于修正，我们需要无缺陷超胞中的静态介电常数和原子位点电位。
因此，必须分配到无缺陷超胞的<code class="docutils literal notranslate"><span class="pre">unitcell.json</span></code>
和<code class="docutils literal notranslate"><span class="pre">calc_results.json</span></code> 的路径。 注意，此命令需要运行一段时间。</p>
<p>此时 <code class="docutils literal notranslate"><span class="pre">pydefect</span></code> 中的能量校正现在使用所谓的扩展
Freysoldt-Neugebauer-Van de Walle (eFNV) 方法进行。
如果使用更正，请引用以下论文。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://journals.aps.org/prl/abstract/10.1103/PhysRevLett.102.016402">C. Freysoldt, J. Neugebauer, and C. Van de Walle, Fully Ab Initio
Finite-Size Corrections for Charged-Defect Supercell Calculations,
Phys. Rev. Lett., 102 016402
(2009).</a></p></li>
<li><p><a class="reference external" href="https://journals.aps.org/prb/abstract/10.1103/PhysRevB.89.195205">Y. Kumagai* and F. Oba, Electrostatics-based finite-size
corrections for first-principles point defect calculations, Phys.
Rev. B, 89 195205
(2014).</a></p></li>
</ul>
<p>获取更正.pdf
文件，其中包含有关缺陷诱导和点电荷电位的信息，以及它们在原子位点的差异，如下所示。</p>
<div class="figure align-default">
<img alt="" src="https://i.loli.net/2021/06/15/fRkEiHtAgq4BopJ.png" />
</div>
<p>水平线的高度表示点电荷电位与缺陷引起的电位之间的平均电位差，即有缺陷超胞的电位减去无缺陷超胞的电位。
线的范围表示平均区域。 有关详细信息，请参阅<a class="reference external" href="https://journals.aps.org/prb/abstract/10.1103/PhysRevB.89.195205">Y. Kumagai* and F. Oba,
Electrostatics-based finite-size corrections for first-principles point
defect calculations, Phys. Rev. B, 89 195205
(2014).</a>。</p>
<p>在进行更正时，强烈建议您检查所有更正.pdf
文件中的计算缺陷，以尽可能减少错误。</p>
</div>
<div class="section" id="id21">
<span id="id22"></span><h2>11. 检查超胞计算中的缺陷特征值和能带边缘状态<a class="headerlink" href="#id21" title="永久链接至标题">¶</a></h2>
<p>通常，点缺陷分为三种类型。</p>
<p>(1)
带隙内具有深局域态的缺陷。这种类型的缺陷通常被认为不利于器件性能，因为载流子被定域态俘获。此外，它们可以作为色心，如
NaCl 中的空位所示。因此，了解局部状态的位置及其起源很重要。</p>
<p>(2) 具有氢载流子状态或扰动主状态 (PHS)
的缺陷，其中载流子位于带边缘，被带电缺陷中心松散地捕获。例如，Si 中的
B-on-Si（p 型）和 P-on-Si（n
型）置换掺杂剂。这些缺陷对器件性能也几乎没有危害，但会引入载流子电子/空穴或杀死源自小俘获能量的反载流子。
PHS
的波函数广泛应用于数百万个原子。因此，为了计算它们的热力学转变能级，我们需要超巨超胞计算，到目前为止，这几乎是第一性原理计算所禁止的。因此，我们通常避免计算这些量，并表示缺陷具有
PHS，并且它们的跃迁能量仅定性地位于带边缘附近。</p>
<p>(3)
带隙内或带边缘附近没有任何缺陷状态的缺陷，只要它们的浓度不是太高，不会对电子特性产生很大影响。</p>
<p>请参阅我们已发表论文中的一些示例。</p>
<ul class="simple">
<li><p><a class="reference external" href="https://link.aps.org/pdf/10.1103/PhysRevB.90.125202">Y. Kumagai*, M. Choi, Y. Nose, and F. Oba, First-principles study of
point defects in chalcopyrite ZnSnP2, Phys. Rev. B, 90 125202
(2014).</a></p></li>
<li><p><a class="reference external" href="https://link.aps.org/doi/10.1103/PhysRevApplied.6.014009">Y. Kumagai*, L. A. Burton, A. Walsh, and F. Oba, Electronic
structure and defect physics of tin sulfides: SnS, Sn2S3, and SnS2,
Phys. Rev. Applied, 6 014009
(2016).</a></p></li>
<li><p><a class="reference external" href="https://journals.aps.org/prapplied/abstract/10.1103/PhysRevApplied.8.014015">Y. Kumagai*, K. Harada, H. Akamatsu, K. Matsuzaki, and F. Oba,
Carrier-Induced Band-Gap Variation and Point Defects in Zn3N2 from
First Principles, Phys. Rev. Applied, 8 014015
(2017).</a>)</p></li>
<li><p><a class="reference external" href="https://journals.aps.org/prapplied/abstract/10.1103/PhysRevApplied.9.034019">Y. Kumagai*, N. Tsunoda, and F. Oba, Point defects and p-type doping
in ScN from first principles, Phys. Rev. Applied, 9 034019
(2018).</a></p></li>
<li><p><a class="reference external" href="https://journals.aps.org/prapplied/abstract/10.1103/PhysRevApplied.10.011001">N. Tsunoda, Y. Kumagai*, A. Takahashi, and F. Oba, Electrically
benign defect behavior in ZnSnN2 revealed from first principles,
Phys. Rev. Applied, 10 011001
(2018).</a></p></li>
</ul>
<p>要区分这三种缺陷类型，需要查看缺陷能级并判断缺陷是否会产生 PHS 或
缺陷局部状态。</p>
<p><code class="docutils literal notranslate"><span class="pre">Pydefect</span></code> 通过以下步骤显示特征值和能带边缘状态。</p>
<p>首先，可以使用以下命令生成 <code class="docutils literal notranslate"><span class="pre">band_edge_eigenvalues.json</span></code> 和
<code class="docutils literal notranslate"><span class="pre">eigenvalues.pdf</span></code> 文件。</p>
<p><code class="docutils literal notranslate"><span class="pre">eigenvalues.pdf</span></code> 文件：</p>
<div class="figure align-default">
<img alt="" src="https://i.loli.net/2021/06/15/umJhSebvPkDYUCZ.png" />
</div>
<p>这张图可以看到，单粒子能级及其在自旋向上和向下通道中的占位。 x
轴是计算出的 k points的分数坐标，而 y 轴是绝对能量标度。
图中实心圆点是每个 k point的单个粒子的能级。</p>
<p>两条水平虚线表示无缺陷的超胞（<strong>perfect
supercell</strong>）中的价带顶和导带底。图中离散的数字表示从 1
开始的能带指数，红色、绿色和蓝色圆点分别表示被占据、部分被占据（从 0.1
到 0.9）和未被占据的本征态。</p>
<p>然后使用以下命令生成 <code class="docutils literal notranslate"><span class="pre">edge_characters.json</span></code> 文件：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">make_edge_characters</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span> <span class="o">-</span><span class="n">pcr</span> <span class="n">perfect</span><span class="o">/</span><span class="n">calc_results</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>并使用此命令分析文件并显示能带边缘状态：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">edge_states</span> <span class="o">-</span><span class="n">d</span> <span class="o">*</span><span class="n">_</span><span class="o">*/</span> <span class="o">-</span><span class="n">p</span> <span class="n">perfect</span><span class="o">/</span><span class="n">edge_characters</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span>-- Mg_i1_0
spin up   Donor PHS
spin down Donor PHS
-- Mg_i1_1
spin up   Donor PHS
spin down No in-gap state
-- Mg_i1_2
spin up   No in-gap state
spin down No in-gap state
-- Va_Mg1_-1
spin up   No in-gap state
spin down In-gap state
-- Va_Mg1_-2
spin up   In-gap state
spin down In-gap state
-- Va_Mg1_0
spin up   No in-gap state
spin down In-gap state
</pre></div>
</div>
<p>有四个状态<code class="docutils literal notranslate"><span class="pre">donor_phs</span></code>、<code class="docutils literal notranslate"><span class="pre">acceptor_phs</span></code>、<code class="docutils literal notranslate"><span class="pre">localized_state</span></code>、no_in_gap，前两个被认为是浅能级状态，在图中应被略去。</p>
<p>在<code class="docutils literal notranslate"><span class="pre">pydefect</span></code>中，这些状态由最高占位和最低未占位特征值以及最高占用（最低未占用）状态和<strong>VBM</strong>（<strong>CBM</strong>）的波函数的相似性确定。</p>
<p>在此我们强调，自动确定的带边状态可能是不正确的，因为通常很难自动确定它们。
因此，请仔细检查带边状态，如果带边状态不明显，请绘制它们的能带分解电荷密度。</p>
<p>能带边缘状态可以通过每个缺陷目录中的 <code class="docutils literal notranslate"><span class="pre">band_edge_states.yaml</span></code>
文件进行修改，在绘制缺陷形成能量时将对其进行解析。</p>
</div>
<div class="section" id="id23">
<span id="id24"></span><h2>12. 绘制缺陷形成能<a class="headerlink" href="#id23" title="永久链接至标题">¶</a></h2>
<p>在这里，我们展示了如何绘制缺陷形成能（defect formation energy）。</p>
<p>缺陷形成能量图需要多种信息，即能带边缘、竞争相的化学势以及无缺陷和有缺陷超胞的总能量。</p>
<p>使用 <code class="docutils literal notranslate"><span class="pre">plot_energy</span></code> (= <code class="docutils literal notranslate"><span class="pre">pe</span></code>) 子命令将缺陷形成能绘制为费米能级函数</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">e</span> <span class="o">--</span><span class="n">unitcell</span> <span class="o">../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">unitcell</span><span class="o">.</span><span class="n">json</span> <span class="o">--</span><span class="n">perfect</span> <span class="n">perfect</span><span class="o">/</span><span class="n">calc_results</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">d</span> <span class="n">Va</span><span class="o">*</span><span class="n">_</span><span class="o">*</span> <span class="o">-</span><span class="n">c</span> <span class="o">../</span><span class="n">competing_phases</span><span class="o">/</span><span class="n">cpd</span><span class="o">.</span><span class="n">yaml</span> <span class="o">-</span><span class="n">l</span> <span class="n">A</span>
</pre></div>
</div>
<div class="figure align-default">
<img alt="" src="https://i.loli.net/2021/06/15/cGvsgpauUDHR5W4.png" />
</div>
<p>当改变化学势的条件，即化学势图中顶点的位置时，使用 <code class="docutils literal notranslate"><span class="pre">-l</span></code> 选项。</p>
</div>
</div>
<div class="section" id="id25">
<h1>第一性原理计算点缺陷相关提示<a class="headerlink" href="#id25" title="永久链接至标题">¶</a></h1>
<div class="section" id="id26">
<span id="id27"></span><h2>1. 如何处理点缺陷的对称性<a class="headerlink" href="#id26" title="永久链接至标题">¶</a></h2>
<p>正如 <a class="reference external" href="https://kumagai-group.github.io/pydefect/tutorial.html">Tutorial of
pydefect</a>中提到的，缺陷附近的相邻原子最初会受到轻微扰动以破坏对称性。
然而，在结构优化过程中，一些缺陷往往会回到对称原子配置或恢复部分对称操作。</p>
<p>即使在这些情况下，最终结构的对称性也并不明显。 <code class="docutils literal notranslate"><span class="pre">Pydefect</span></code>
提供了一个允许对缺陷结构进行对称化的脚本：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python $PYDEFECT_PATH/pydefect/cli/vasp/util_commands/make_refined_poscar.py
</pre></div>
</div>
<p>如果结构不是 P1 对称，此命令将创建对称 <code class="docutils literal notranslate"><span class="pre">POSCAR</span></code> 文件。 然后，之前的
<code class="docutils literal notranslate"><span class="pre">OUTCAR</span></code> 和 CONTCAR 分别重命名为 <code class="docutils literal notranslate"><span class="pre">OUTCAR.sym_1</span></code> 和
<code class="docutils literal notranslate"><span class="pre">CONTCAR.sym_1</span></code>。</p>
<p>也可以在 runshell 脚本中包含此命令，例如，</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">$VASP_cmd</span>

hostname &gt; host
<span class="nv">name</span><span class="o">=</span><span class="sb">`</span>basename <span class="s2">&quot;</span><span class="nv">$PWD</span><span class="s2">&quot;</span><span class="sb">`</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$name</span> !<span class="o">=</span> <span class="s2">&quot;perfect&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    python <span class="nv">$PYDEFECT_PATH</span>/pydefect/cli/vasp/util_commands/make_refined_poscar.py
    <span class="k">if</span> <span class="o">[</span> -e CONTCAR.sym_1 <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nv">$VASP_cmd</span>
    <span class="k">fi</span>
<span class="k">fi</span>
</pre></div>
</div>
</div>
<div class="section" id="id28">
<span id="id29"></span><h2>2. 混合函数计算的技巧<a class="headerlink" href="#id28" title="永久链接至标题">¶</a></h2>
<p>混合泛函(Hybrid functionals)，尤其是 HSE06
泛函，以及具有不同交换混合参数或筛选距离的泛函，也经常用于点缺陷计算。</p>
<p>通常，混合泛函计算比基于局部或半局部密度近似的泛函计算成本要高几十倍。
因此，我们需要花点心思来降低他们的计算成本。</p>
<p>为此，我们定期准备使用 GGA 函数获得的 WAVECAR 文件。
（虽然我们也可以事先使用 GGA
放宽原子位置，但它可能不适合点缺陷计算，因为 GGA
计算的缺陷的位点对称性可能与混合泛函不同。）</p>
<p>例如，可以使用 GGA 使用以下命令创建 INCAR 文件以生成 WAVECAR 文件。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">grep</span> <span class="o">-</span><span class="n">v</span> <span class="n">LHFCALC</span> <span class="n">INCAR</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">v</span> <span class="n">ALGO</span> <span class="o">|</span> <span class="n">sed</span> <span class="n">s</span><span class="o">/</span><span class="s2">&quot;NSW     =  50&quot;</span><span class="o">/</span><span class="s2">&quot;NSW     =   1&quot;</span><span class="o">/</span> <span class="o">&gt;</span> <span class="n">INCAR</span><span class="o">-</span><span class="n">pre</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id30">
<h1>计算垂直跃迁能级向导<a class="headerlink" href="#id30" title="永久链接至标题">¶</a></h1>
<p>我们在此以 NaCl 为例说明如何计算垂直跃迁能级 (<strong>VTL</strong>)。 对于 VTL
的计算，我们需要应用特殊的校正方案，这里我们称之为 GKFO 校正。 请阅读
<a class="reference external" href="https://kumagai-group.github.io/pydefect/link.aps.org/doi/10.1103/PhysRevB.101.020102">T. Gake, Y. Kumagai*, C. Freysoldt, and F. Oba, Phys. Rev. B, 101,
020102(R)
(2020)</a>获取详情。</p>
<p>假设已经按照教程中的介绍完成了基于 PBEsol 泛函的 NaCl
中的重要缺陷的计算，并且进一步希望通过中性电荷态的 Cl 空位计算光吸收能。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>NaCl
 │
 ├ unitcell/ ── unitcell.json
 │
 └ defects/ ── perfect/
             └ Va_Cl_0/ ── absorption/
</pre></div>
</div>
<p>首先，在 <code class="docutils literal notranslate"><span class="pre">Va_Cl_0/</span></code> 创建 <code class="docutils literal notranslate"><span class="pre">absorption/</span></code>目录并从 <code class="docutils literal notranslate"><span class="pre">Va_Cl_0/</span></code> 复制
vasp 输入文件。 然后，编辑 <code class="docutils literal notranslate"><span class="pre">INCAR</span></code> 将 <code class="docutils literal notranslate"><span class="pre">NSW</span></code> 更改为 1，并添加
<code class="docutils literal notranslate"><span class="pre">NELECT</span></code> 标记，将其从中性标记减少 1。 或者可以输入：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">vise</span> <span class="n">vs</span> <span class="o">-</span><span class="n">uis</span> <span class="n">NSW</span> <span class="mi">1</span> <span class="o">--</span><span class="n">options</span> <span class="n">charge</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="n">d</span> <span class="o">../</span> <span class="o">-</span><span class="n">t</span> <span class="n">defect</span>
</pre></div>
</div>
<p>运行vasp后，我们然后在<code class="docutils literal notranslate"><span class="pre">absolute/</span></code>目录中使用以下命令创建<code class="docutils literal notranslate"><span class="pre">calc_results.json</span></code>。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">cr</span> <span class="o">-</span><span class="n">d</span> <span class="o">.</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="n">gkfo</span> <span class="o">-</span><span class="n">u</span> <span class="o">../../../</span><span class="n">unitcell</span><span class="o">/</span><span class="n">unitcell</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">iefnv</span> <span class="o">../</span><span class="n">correction</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">icr</span> <span class="o">../</span><span class="n">calc_results</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">fcr</span> <span class="n">calc_results</span><span class="o">.</span><span class="n">json</span> <span class="o">-</span><span class="n">cd</span> <span class="mi">1</span>
</pre></div>
</div>
<p>通过该命令可以获取<code class="docutils literal notranslate"><span class="pre">gkfo_correction.pdf</span></code>和<code class="docutils literal notranslate"><span class="pre">gkfo_correction.json</span></code>文件，校正能量如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+--------------------+------------+</span>
<span class="o">|</span> <span class="n">charge</span>             <span class="o">|</span>  <span class="mi">0</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">additional</span> <span class="n">charge</span>  <span class="o">|</span>  <span class="mi">1</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">pc</span> <span class="mi">1</span><span class="n">st</span> <span class="n">term</span>        <span class="o">|</span>  <span class="mi">0</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">pc</span> <span class="mi">2</span><span class="n">nd</span> <span class="n">term</span>        <span class="o">|</span>  <span class="mf">0.731247</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">alignment</span> <span class="mi">1</span><span class="n">st</span> <span class="n">term</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.0338952</span> <span class="o">|</span>
<span class="o">|</span> <span class="n">alignment</span> <span class="mi">2</span><span class="n">nd</span> <span class="n">term</span> <span class="o">|</span> <span class="o">-</span><span class="mf">0.113709</span>  <span class="o">|</span>
<span class="o">|</span> <span class="n">alignment</span> <span class="mi">3</span><span class="n">rd</span> <span class="n">term</span> <span class="o">|</span> <span class="o">-</span><span class="mi">0</span>         <span class="o">|</span>
<span class="o">|</span> <span class="n">correction</span> <span class="n">energy</span>  <span class="o">|</span>  <span class="mf">0.583643</span>  <span class="o">|</span>
<span class="o">+--------------------+------------+</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">gkfo_correction.pdf</span></code> 显示了由添加/移除电子及其对齐项引起的电位分布。</p>
<div class="figure align-default">
<img alt="" src="https://i.loli.net/2021/06/15/B5VDHaMRsPqp2Jj.png" />
</div>
<p>对于吸收能量，需要知道导带最小位置，现在是 4.7777 eV。
初态和终态的总能量为-219.02114546 eV和-222.32750506 eV。 因此，吸收能为</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="mf">222.32750506</span><span class="o">+</span><span class="mf">219.02114546</span><span class="o">+</span><span class="mf">4.7777</span><span class="o">+</span><span class="mf">0.583643</span> <span class="o">=</span> <span class="mf">2.0549834</span> <span class="n">eV</span>
</pre></div>
</div>
<p>检查初始状态和最终状态的特征值也是必要的。 使用 eig 子解析器（eig
sub-parser）：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pydefect</span> <span class="o">-</span><span class="n">d</span> <span class="o">.</span> <span class="o">-</span><span class="n">pcr</span> <span class="o">../../</span><span class="n">perfect</span><span class="o">/</span><span class="n">calc_results</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>我们可以获得<code class="docutils literal notranslate"><span class="pre">eigenvalues.pdf</span></code>，如下：</p>
<div class="figure align-default">
<img alt="" src="https://i.loli.net/2021/06/15/P1kRgnTIzibasql.png" />
</div>
<p>初始的 eigenvalues.pdf 如下：</p>
<div class="figure align-default">
<img alt="" src="https://i.loli.net/2021/06/15/pR8cEAmv3SJTI14.png" />
</div>
</div>
<div class="section" id="note">
<h1>Note<a class="headerlink" href="#note" title="永久链接至标题">¶</a></h1>
<p>本中文教程基于kumagai’s
Group发布的pydefect英文向导进行的翻译校正，源文档如下：</p>
<p><a class="reference external" href="https://kumagai-group.github.io/pydefect/change_log.html">https://kumagai-group.github.io/pydefect/change_log.html</a></p>
<p>Based on Version 0.2.6</p>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; 版权所有 2021, Xiaoyu Wu.

    </p>
  </div>
    
    
    
    利用 <a href="https://www.sphinx-doc.org/">Sphinx</a> 构建，使用了 
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>
    
    由 <a href="https://readthedocs.org">Read the Docs</a>开发. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>